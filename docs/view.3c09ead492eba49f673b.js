(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{47:function(t,e,a){"use strict";a.r(e),a.d(e,"initUiLanguage",(function(){return I})),a.d(e,"getActiveMenu",(function(){return A})),a.d(e,"setActiveMenu",(function(){return N})),a.d(e,"init",(function(){return L})),a.d(e,"initByClass",(function(){return R}));var n=a(2),r=a.n(n),o=a(1),i=a(4),c=a(7),s=(a(6),a(45)),u=a.n(s),d=a(46),l=a.n(d),f=a(16),h=a.n(f),p="",g=[],v=[],m=0,C=0,b=0,k=0,x=0,y=.2,S=99999,T="nogold",w=!1,D={1:11,2:21,3:31,4:41,5:51,6:61},I=function(){r()("[data-lang]").each((function(){var t=r()(this),e=t.data("lang"),a=i.a.getText(e);t.text(a)}))},A=function(){return p},N=function(t){p=t,r()("nav.navbar [data-type-branch-id].active").removeClass("active");var e=r()("nav.navbar [data-type-branch-id="+t+"]");e.addClass("active"),e.parents("li").addClass("active"),r()("#class").text(e.text())},R=function(t,e,a){D[t]&&(t=D[t]),L(t,e,a)},L=function(t,e,a){a&&a!=c.Data.getCurrentServer().id&&(c.Data.setCurrentServer(a),location.reload()),M(),E(),W(t,e)},M=function(){g=[],v=[]},E=function(){if(!w){var t=c.Data.getCurrentServer();r()("#server").text(t.name),r()("#version").text(t.version),t.isTest?r()(".alert").show():r()(".alert").remove(),o.default.each(c.Data.getAllServers(),(function(e,a){e.version&&r()("#serverDivider").before('<a class="dropdown-item '+(e.id==t.id?" active ":"")+(e.version?"":" disabled ")+'" href="#server/'+e.id+'">'+e.name+'<div class="m-0" style="font-size:0.75rem;line-height:0.75rem;">'+e.version+"</div></a>")})),r()("#btnSearch").click((function(){var t=r()("#txtSearch").val(),e=r()('.rune[data-name="'+t+'"]').not(".rune-not-available");if(e.popover("show"),e.length){var a=9999999;e.each((function(t,e){a=Math.min(a,parseFloat(r()(e).css("top")))})),r()("#main").animate({scrollTop:Math.max(a-50,0)},500)}else alert(i.a.getText("runenotexist"))})),r()("#btnClear").click((function(){r()('[data-toggle="popover"]').popover("hide")})),r()("#btnSelectAll").click((function(){var t=c.Data.getAstrolabe();o.default.each(t,(function(t,e){z(t.Id,!0,!1)})),B(),Y()})),r()("#btnSaveImage").click((function(){var t=window.open("about:blank;","_blank");r()(t.document.body).append(i.a.getText("generating")),l.a.toPng(r()(".astrolabe-container")[0],{bgcolor:"#fff"}).then((function(e){r()(t.document.body).empty(),r()(t.document.body).append(r()('<textarea style="width:100%;height:100px;">').val(window.location)),r()(t.document.body).append(r()("<img>").attr("src",e))})).catch((function(t){console.error(i.a.getText("generateerror"),t)}))})),r()("#btnReset").click((function(){confirm(i.a.getText("confirmreset"))&&(o.default.each(v,(function(t,e){r()("#rune"+t).data("status",0).removeClass("rune-checked")})),v=[],B(),Y())})),r()("#btnSave").click((function(){P()})),r()('input[name="evo"]').change((function(){S=parseInt(this.value),W(m)})),r()("#scale").change((function(){y=parseFloat(this.value)||.2,W(m)})),r()('input[name="pathAlgorithm"]').change((function(){"custom"==(T=this.value)?r()("#algorithmWeight").show():r()("#algorithmWeight").hide()})),r()(".rune-panel-switch").click((function(){r()(".rune-panel-main").toggle()})),w=!0}},W=function(t,e){console.log("render",t,e);if(0!=t){N(m=t),r()("#main").find("img").attr("src",""),r()("#main").empty();var a=c.Data.getAstrolabe();C=o.default.min(a,(function(t){return t.X})).X,b=o.default.max(a,(function(t){return t.X})).X,k=o.default.min(a,(function(t){return t.Y})).Y,x=o.default.max(a,(function(t){return t.Y})).Y;var n,i=r()("<div>").addClass("astrolabe-container");o.default.each(a,(function(t,e){var a=c.Data.getRuneCost(t.Id),n=c.Data.getRuneResetCost(t.Id),s=c.Data.getRuneDesc(t.Id,m),u=r()("<div>").addClass("rune").css("left",(t.X-C+30)*y).css("top",(x-t.Y+30)*y).css("width",60*y).css("height",60*y).attr("id","rune"+t.Id).attr("data-id",t.Id).data("rune",t).data("cost",a).data("resetCost",n).data("desc",s).data("status",0).attr("data-toggle","popover").attr("data-name",s.Name).attr("data-content",'<ul class="list-group list-group-flush"><li class="list-group-item p-1">'+(s.Desc||"")+'</li><li class="list-group-item p-1">'+o.default.reduce(a,(function(t,e){return t+e.Name+"*"+e.Count+" "}),"")+"</li></ul>").click((function(){X(t.Id)}));1e4==t.Id&&(g.push(1e4),u.addClass("rune-center").data("status",2).attr("title","").attr("data-toggle","")),t.Evo>S&&u.addClass("rune-not-available").attr("title","").attr("data-toggle","").off("click"),o.default.any(a,(function(t){return 5261==t.Id}))&&u.addClass("rune-special"),(t.X-C)/(b-C)>.8&&u.attr("data-placement","left"),(x-t.Y)/(x-k)<.2&&u.attr("data-placement","bottom"),i.append(u)})),r()("#main").append(i),r()('[data-toggle="popover"]').popover({html:!0,trigger:"hover focus",container:".astrolabe-container"}),r()("#main").on("show.bs.popover",(function(t){var e=r()(t.target),a=e.data("desc"),n=e.data("status"),o=r()("<div>").append(r()("<div>").addClass("rune-icon").addClass("rune-"+(0==n?"off":"on")+"-"+a.Type).text(a.Name).append('<div class="rune-id d-none">'+e.attr("data-id")));e.attr("data-original-title",o.html())})),r()("#main").on("inserted.bs.popover",(function(t){var e=0;r()(".popover").each((function(t,a){var n=r()(a);if(e<parseInt(n.css("z-index"))&&(e=parseInt(n.css("z-index"))),n.find("button.close").length<1){var o=r()('<button type="button" id="close" class="close">&times;</button>');o.click((function(){r()(this).parents(".popover").popover("hide")})),n.find(".popover-header").append(o)}})),r()(".popover:last").css("z-index",e+1).off("mouseenter").off("click").on("mouseenter click",(function(){var t=0;r()(".popover").each((function(e,a){t<parseInt(r()(a).css("z-index"))&&(t=parseInt(r()(a).css("z-index")))})),r()(this).css("z-index",t+1)})).on("click",".rune-icon",(function(){r()(t.target).popover("hide"),X(parseInt(r()(this).find(".rune-id").text()))}))})),r()("#txtSearch").empty(),o.default.each(c.Data.getAllRuneDescNameByTypeBranch(m),(function(t,e){r()("#txtSearch").append(r()("<option>").text(t).val(t))})),r()(".selectpicker").selectpicker("refresh"),e&&(n=e,g=JSON.parse(u.a.decompressFromEncodedURIComponent(n))),o.default.each(g,(function(t,e){z(t,!0,!0)})),o.default.each(v,(function(t,e){z(t,!0,!1)})),B(),Y()}},Y=function(){r()(".rune-link-container").remove();var t=(b-C+120)*y,e=(x-k+120)*y,a=r()("<canvas>").attr("width",t).attr("height",e).addClass("rune-link-container");r()(".astrolabe-container").append(a);var n=a[0].getContext("2d");n.fillStyle="rgba(0, 0, 0, 0.25)",n.font="25px PingFang SC,Source Han Sans SC,Noto Sans CJK SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,sans-serif";var s=c.Data.getCurrentServer();s.isTest&&(n.textAlign="left",n.fillText(i.a.getText("alertCBT"),0,25)),n.textAlign="left",n.fillText(r()("#runeCheckCost").data("cost"),0,e-5),n.fillText(r()("#runeCost").data("cost"),0,e-35),n.font="18px Consolas",n.textAlign="right",n.fillText("ROMEL Rune BFS",t,e-65),n.fillText("Version:"+s.version+"("+s.id+")",t,e-45),n.fillText("©Gravity Co., Ltd. & LeeMyoungJin(studio DTDS) All rights reserved.",t,e-25),n.fillText("©GungHo Online Entertainment, Inc. All Rights Reserved.",t,e-5),o.default.each(c.Data.getAstrolabe(),(function(t,e){var a=t;o.default.each(a.Link,(function(t,e){var r=c.Data.getRuneDataById(t);r&&(n.beginPath(),n.moveTo((a.X-C+60)*y,(x-a.Y+60)*y),n.lineTo((r.X-C+60)*y,(x-r.Y+60)*y),n.lineWidth=3,a.Evo>S||r.Evo>S?(n.strokeStyle="rgba(233, 233, 233, 0.15)",n.stroke()):o.default.contains(g.concat(v),a.Id)&&o.default.contains(g.concat(v),r.Id)?(n.lineWidth=4,n.strokeStyle="#13a7ff",n.stroke(),n.lineWidth=3,n.strokeStyle="#85e2ff",n.stroke(),n.lineWidth=2,n.strokeStyle="#cef3ff",n.stroke(),n.lineWidth=1,n.strokeStyle="#eefcff",n.stroke()):(n.strokeStyle="#333",n.stroke()))}))}))},B=function(){var t=[],e=[],a=[],n=[],c=[],s=[];r()(".rune").each((function(o,i){var u=r()(i),d=(u.data("rune"),u.data("desc")),l=u.data("status"),f=u.data("cost"),h=u.data("resetCost");switch(l){case 0:break;case 1:e.push(f),n.push(h),s.push(d);break;case 2:t.push(f),a.push(h),c.push(d)}})),e=o.default.reduce(e,(function(t,e){return o.default.each(e,(function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count})),t}),{}),t=o.default.reduce(t,(function(t,e){return o.default.each(e,(function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count})),t}),{});var u="";o.default.each(e,(function(t,e){u+=e+"*"+t.toLocaleString()+" "}));var d="";o.default.each(t,(function(t,e){d+=e+"*"+t.toLocaleString()+" "})),n=o.default.reduce(n,(function(t,e){return o.default.each(e,(function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count})),t}),{}),a=o.default.reduce(a,(function(t,e){return o.default.each(e,(function(e,a){t[e.Name]=(t[e.Name]||0)+e.Count})),t}),{});var l="";o.default.each(n,(function(t,e){l+=e+"*"+t.toLocaleString()+" "}));var f="";o.default.each(a,(function(t,e){f+=e+"*"+t.toLocaleString()+" "})),s=o.default.reduce(s,(function(t,e){return e&&e.Key?(t[e.Key]=(t[e.Key]||0)+e.Value,t):t}),{}),c=o.default.reduce(c,(function(t,e){return e&&e.Key?(t[e.Key]=(t[e.Key]||0)+e.Value,t):t}),{});var h="",p=0;o.default.each(s,(function(t,e){p++,h+=i.a.getEquipEffect(e)+"+"+(Math.round(100*t)/100).toLocaleString()+" ",p%4==0&&(h+="<br/>")}));var g="";p=0,o.default.each(c,(function(t,e){p++,g+=i.a.getEquipEffect(e)+"+"+(Math.round(100*t)/100).toLocaleString()+" ",p%4==0&&(g+="<br/>")})),r()("#runeCheckCost").empty().append(u.trim()+"("+l.trim()+")<br/>"+h.trim()),r()("#runeCheckCost").data("cost",u.trim()+"("+l.trim()+")"),r()("#runeCost").empty().append(d.trim()+"("+f.trim()+")<br/>"+g.trim()),r()("#runeCost").data("cost",d.trim()+"("+f.trim()+")")},X=function(t){if(1e4==t)F(t);else switch(r()("#rune"+t).data("status")){case 0:z(t);break;case 1:K(t);break;case 2:F(t)}B(),Y()},z=function(t,e,a){if(1e4!=t){var n=r()("#rune"+t);if(!(n.data("rune").evo>S))if(e){if(a){if(n.data("status")>=2)return;n.data("status",2).addClass("rune-saved")}else{if(n.data("status")>=1)return;n.data("status",1).addClass("rune-checked"),v.push(t)}r()('.rune-icon[runeId="'+t+'"]').toggleClass("rune-off-"+n.data("desc").Type).toggleClass("rune-on-"+n.data("desc").Type)}else{var s=[];switch(T){case"simple":s=c.Data.getPath(g.concat(v),t,S);break;case"nogold":s=c.Data.getPathWithWeight(g.concat(v),t,S);break;case"custom":var u=[{id:140,weight:parseFloat(r()("#weight140").val())||0},{id:5261,weight:parseFloat(r()("#weight5261").val())||0}];s=c.Data.getPathWithWeight(g.concat(v),t,S,u)}if(console.log("getPath",T,s),!s.length)return void alert(i.a.getText("nopath"));o.default.each(s,(function(t,e){z(t,!0)}))}}},F=function(t){confirm(i.a.getText("confirmuncheck"))&&K(t)},K=function(t,e){var a=r()("#rune"+t);if(!(a.data("rune").evo>S)){if(a.data("status",0).removeClass("rune-checked").removeClass("rune-saved"),r()('.rune-icon[runeId="'+t+'"]').toggleClass("rune-off-"+a.data("desc").Type).toggleClass("rune-on-"+a.data("desc").Type),g=o.default.without(g,t),v=o.default.without(v,t),!e){var n=c.Data.getConnectedComponent(g.concat(v));o.default.each(n,(function(t,e){0==o.default.contains(t,1e4)&&o.default.each(t,(function(t,e){K(t,!0)}))}))}g=o.default.union(g,[1e4])}},P=function(){g=o.default.unique(g.concat(v)),v=[],o.default.each(g,(function(t,e){r()("#rune"+t).data("status",2).removeClass("rune-checked").addClass("rune-saved")})),B(),Y();var t,e=(t=g,u.a.compressToEncodedURIComponent(JSON.stringify(t)));h.a.history.navigate("typeBranch/"+m+"/share/"+e+"/server/"+c.Data.getCurrentServer().id,{trigger:!1})};e.default={initUiLanguage:I,getActiveMenu:A,setActiveMenu:N,init:L,initByClass:R}}}]);